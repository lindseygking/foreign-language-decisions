---
title             : "How Foreign Language Impacts Moral Decision Making"
shorttitle        : "Foreign Language Decision Making"

author: 
  - name          : "Lindsey King"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    email         : "lindseyking@uchicago.edu"
    role: # Contributorship roles (e.g., CRediT, https://credit.niso.org/)
      - "Conceptualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"


affiliation:
  - id            : "1"
    institution   : "University of Chicago"


authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  One or two sentences to put the results into a more **general context**.
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : "r-references.bib"

floatsintext      : yes
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")

# add in R script
source("FLDM.R")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r script}
# source R script
source("FLDM.R")
```

```{r helloworld}
# call hello world function
hello_world("French")
```

<!-- Assignment #5 basic markdown formatting practice -->

# **_Formatting Practice_**

## **Ordered List**
### _ToDo List_
1. [D2M Homework](https://nrdowling.github.io/d2m/index.html#Course_schedule) 
2. Put away laundry
3. Unload dishwasher
4. Watch Packers game (go pack)

## **Unordered List**
### _Grocery List_
* Eggs
* Milk
* Bread

```{r data read-in}
# read dataset from csv file into rmd
FLDM_data <- read.csv("S1_Dataset.csv")
```

<!-- data tidying todo
  - remove extra columns (only need r2 mean score, not individuals)
  - arrange participant IDs in order 
  - add zeros before id numbers with stringr to make each id number 3 digits long (consistency) -->

```{r tidy data}
library(tidyverse)
# create new tidy dataframe from original dataframe
FLDM_tidy <- FLDM_data %>% 
  # remove unwanted columns
  select(-c(l2.conversation, l2.reading, l2.understanding, l2.writing)) %>% 
  #arrange the ID numbers in ascending order
  arrange(ID)

# export tidy dataframe to a csv file
write_csv(FLDM_tidy, "~/Desktop/UCHI Q2/d2m/foreign-language-decisions/FLDM_tidy.csv") 
```

```{r long data}
library(tidyverse)
library(reshape2)
# read dataset from csv file 
FLDM_tidy_long <- read.csv("FLDM_tidy.csv") %>%
  # remove extraneous columns
  select(-c(order, l2.mean.skills, l2.years, age, gender)) %>% 
  # remove outlier row
  slice(-c(74)) %>% 
  # make data longer by having dilemma type as its own column 
  pivot_longer(cols = c("trolley.choice", "footbridge.choice", "non.moral.choice"),
               names_to = "dilemma.type",
               values_to = "dilemma.choice")

FLDM_tidy_long$language.group <- as.factor(FLDM_tidy_long$language.group)
  
# add zeros before id numbers with stringr to make each id number 3 digits long (consistency)
FLDM_tidy_long$ID <- str_pad(FLDM_tidy_long$ID, 3, pad = '0') 

FLDM_German <- FLDM_tidy_long %>% 
  filter(language.group != 5)

FLDM_English <- FLDM_tidy_long %>% 
  filter(language.group != 3)
```
  
# Methods

## Participants
Participants were 
## Material

## Procedure

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.

# Assignment 10 plot markups
```{r English, fig.cap="Italian versus English"}
#install.packages("magick")
library(magick)
library(ggplot2)
library(scales)
## plot showing average choices for each moral dilemma in native versus foreign lang.

FLDM_English %>% 
  ggplot(aes(x = dilemma.type, y = dilemma.choice, fill = language.group)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  facet_wrap(vars(language.group),
             labeller = labeller(language.group = c(`1` = "Native (Italian)", `5` = "Foreign (English)"))) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  theme_bw() +
  scale_fill_manual(values = c("#d4729f", "#f09d5d")) +
  labs(x = "Dilemma", y = "Consequentialist Response")
```
 


```{r German, fig.cap="Italian versus German"}

## plot showing native versus German
# green hex for German #63a15f

FLDM_German %>% 
  ggplot(aes(x = dilemma.type, y = dilemma.choice, fill = language.group)) +
  geom_bar(position = 'dodge', stat = 'identity') +
  scale_y_continuous(labels = scales::percent_format(scale = 100)) +
  theme_bw() +
  scale_fill_manual(values = c("#d4729f", "lavender"), labels = c('Native (Italian)', 'Foreign (German)'),) +
  labs(x = "Dilemma", y = "Consequentialist Response", fill = "Language Group")

# clean up to match the labels and formatting of first plot
```
```{r Proficiency, fig.cap="Proficiency of foreign language."}
### Third bonus plot still in the works

FLDM_tidy_long %>% 
  filter(language.condition == 0) %>% 
  ggplot(aes(x = proficiency, y = dilemma.choice)) +
  geom_jitter(stat = "identity") +
  geom_smooth()
```

```{r demographics df}
# df for demographics table 
Condition <- c('Italian', 'German', 'English')
N <- c(39, 28, 36)
trolley.means <- c('54%','73%','61%')
footbridge.means <- c('13%', '43%', '36%')
non.moral.means <- c('87%', '92%', '93%')
FLDM_demographics <- data.frame(Condition, N, trolley.means, footbridge.means, non.moral.means)

```

```{r demographic-table}
library(knitr)
library(tidyverse)
library(kableExtra)

kable(FLDM_demographics, caption = 'Demographics With Consequentialist Means', col.names = c('Condition', 'N', 'Trolley Mean %', 'Footbridge Mean %', 'Non-Moral Mean %'), align = 'c') %>% 
 kable_styling(bootstrap_options = c("striped", "hover"), full_width = F)

```

## Assignment 15 analysis plans
# descriptive
summarized df of dilemma choices for each language condition 
```{r descriptive}
## Assignment 16 conduct descriptive analysis 

# select only the necessary groups
FLDM_desc <- FLDM_data %>% 
  select(language.group, trolley.choice, footbridge.choice, non.moral.choice) %>% 
  drop_na() 

# make longer for sake of dplyr
FLDM_desc_long <- FLDM_desc %>% 
  pivot_longer(c(trolley.choice, footbridge.choice, non.moral.choice), names_to = "dilemma.type")

# group by language group and dilemma choice to get descriptives for each subgroup 
FLDM_desc_long %>% 
  group_by(language.group, dilemma.type) %>% 
  summarize(mean = mean(value),
            median = median(value),
            sd = sd(value))
```

```{r descriptive-ungrouped}
# not grouped by language condition to show totals 
FLDM_desc_long %>% 
  group_by(dilemma.type) %>% 
  summarize(mean = mean(value),
            median = median(value),
            sd = sd(value))

```

# hypothesis test 
ANCOVA for effect of language group on dilemma choice for each dilemma type 

```{r hypothesis-test}
## ANCOVA 
library(car)
library(psych)
library(stats)
library(lme4)
library(scales)
library(broom)
library(papaja)
anova_language_dilemma <- aov(value ~ language.group + dilemma.type, data=FLDM_desc_long)
ancova_language_dilemma <- Anova(anova_language_dilemma, type="III")

tidy_ancova <- tidy(ancova_language_dilemma)

ancova_language_dilemma
```


# Results

A significant effect of dilemma type on consequentialism across language conditions ($p$ `r apa_p(tidy_ancova[[3, "p.value"]], add_equals=T)`) is seen showing that any differences in consequentialism are not due to misunderstanding in the foreign language. This is because we expect consequentialism to be highest in the non-moral dilemma ($\mu$ = `r mean(FLDM_desc$non.moral.choice)`) and lowest in the footbridge dilemma ($\mu$ = `r mean(FLDM_desc$footbridge.choice)`) . This is because there is no moral dilemma in the non-moral dilemma and therefore no reason to not choose the consequentialist response where as the inverse is true for the footbridge dilemma. The trolley dilemma falls in the middle ($\mu$ = `r mean(FLDM_desc$trolley.choice)`). To understand these percentages better, they can be viewed in Figure\ \@ref(fig:English) and Figure\ \@ref(fig:German).

Table\ \@ref(tab:demographic-table) shows the breakdown of the language categories as well as the mean consequentialism participants exhibited for the different dilemmas. There is a significant effect of 
language condition on consequentialism ($p$ `r apa_p(tidy_ancova[[2, "p.value"]], add_equals=T)`). 


# Discussion


\newpage

# References

::: {#refs custom-style="Bibliography"}
:::
